var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var h=0;return function(){return h<b.length?{done:!1,value:b[h++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.makeIterator=function(b){var h="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return h?h.call(b):$jscomp.arrayIterator(b)};
function applicationManager(b){console.log("applicationManager");var h,w=$jscomp.makeIterator(d3.extent(b,function(a){return a.Step})),t=w.next().value,y=w.next().value,v,l,u,r=10,A=1E5*~~(d3.min(b,function(a){return a.currenttimestamp})/1E5),O=d3.max(b,function(a){return a.currenttimestamp}),K,p=function(a){var b=d3.nest().key(function(a){return a.Operation}).entries(a),h=d3.nest().key(function(a){return a.Process_Name}).entries(a),n=d3.nest().key(function(a){return a.Process}).entries(a),f=function(){var f=
    {};a.forEach(function(a){a.hasOwnProperty("Domain")&&(f.hasOwnProperty(a.Domain)||(f[a.Domain]=a))});return f}();return{getdatabyOperation:b,getdatabyProcessName:h,getdatabyProcess:n,getdatabyDomain:f}}(b);return{drawStats:function(a){var b=settings.ProcessArea.left,x=settings.ProcessArea.bar_height,n=p.getdatabyProcess;operationShown=p.getdatabyOperation.map(function(a){return a.key});var f;d3.select(a).selectAll("*").remove();svgStats=d3.select(a).append("svg").attr("id","overview").attr("width",
        "100%").attr("height",20+x*n.length).attr("y",0);a=document.getElementById("overview").getBoundingClientRect().width;var C=d3.scaleLinear().domain([1,d3.max(n,function(a){return a.values.length})]).range([1,Math.min(a-b-50,settings.ProcessArea.scale_xMax)]),q=0;n.forEach(function(a,g){var n=svgStats.append("g").attr("transform","translate(0,"+(10+g*x)+")"),m=d3.nest().key(function(a){return a.Operation}).entries(a.values);m=m.sort(function(a,f){return f.values.length-a.values.length});var k=b;m.forEach(function(a){n.append("rect").attr("id",
        "ovRect"+a.key.replace(" ","")).attr("x",k).attr("width",function(){return C(a.values.length)}).attr("height",30).attr("fill",function(){return colorPicker(a.key)}).classed("g"+a.key.replace(" ",""),!0).classed("op0","Process Profiling"===a.key).classed("op1","Process Profiling"!==a.key).on("mouseover",function(){f=d3.select(this).attr("class");d3.select(this).classed("op2",!0).classed("op0 op1",!1);divOperation.transition().duration(200).style("opacity",.9);divOperation.html("Operation: "+a.key+
        "<br/> Total calls: "+a.values.length.toLocaleString()+"<br/>").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px").style("pointer-events","none").style("background-color","#cccccc").style("padding","5px")}).on("mouseleave",function(a){divOperation.style("opacity",0);d3.select(this).classed("op0 op1 op2",!1).classed(f,!0)}).on("click",function(){var b=this;document.getElementById("opSelection").checked=!1;if(void 0===firstClick){firstClick=!0;var g=a.key.replace(" ","");"ProcessProfiling"===
    a.key.replace(" ","")?(console.log("bingo"),d3.select("#heatmap").selectAll("rect."+g).style("visibility","visible").raise(),h=d3.selectAll("[class*=o"+g+"]"),h.classed("visible",!active[g]).classed("hidden",!!active[g]).raise(),f=d3.select(this).attr("class").split(" ")[0]+" op1"):(d3.select("#heatmap").selectAll("rect[group=detail]").style("visibility","hidden"),d3.selectAll(".arc").classed("hidden",!0),svgStats.selectAll("rect").classed("op0",!0).classed("op1 op2",!1),d3.select("#heatmap").selectAll("rect."+
        g).style("visibility","visible").raise(),h=d3.selectAll("[class*=o"+g+"]"),h.classed("visible",!active[g]).classed("hidden",!!active[g]).raise(),d3.select(this).classed("op1",!0).classed("op0 op2",!1));active[g]=!active[g]}else{var k=a.key.replace(" ","");d3.select(this).classed("op1",function(){var a=active[k]?" op0":" op1";f=d3.select(b).attr("class").split(" ")[0]+a;return!active[k]}).classed("op2",!1).classed("op0",!!active[k]);d3.selectAll("[class*=o"+k+"]").classed("visible",!active[k]).classed("hidden",
        !!active[k]).raise();d3.select("#heatmap").selectAll("rect."+k).style("visibility",active[k]?"hidden":"visible").raise();active[k]=!active[k]}});n.append("clipPath").attr("id","clip-"+q).append("use").attr("xlink:href","#ovRect"+a.key.replace(" ",""));n.append("text").attr("clip-path",function(a){return"url(#clip-"+q+")"}).selectAll("tspan").data([a.key]).enter().append("tspan").classed("unselectable",!0).attr("x",k+1).attr("y",18).text(function(a){return a}).attr("fill","white").attr("font-size",
        "11px").attr("font-family","sans-serif");k+=C(a.values.length)+2;q++});n.append("text").text(a.key+" ("+a.values.length+")").attr("x",0).attr("y",18)})},drawStats2:function(a){d3.select(a).selectAll("*").remove();var g=d3.select(a).append("svg").attr("width","100%").attr("height",1190).append("g");d3.keys(list).forEach(function(a,b){var f=g.append("g").attr("transform","translate(0,"+15*b+")");f.append("rect").attr("width","20px").attr("height","12px").attr("fill",function(f){return colorPicker(a)});
        f.append("text").text(a).attr("x","30px").style("color","black").style("font-size","12px").attr("y","10px")})},loadMatrix:function(){return loadMatrix(void 0)},drawMain:function(a){function g(c,a){if(void 0==c.isDone&&(a.push(c),c.isDone=!0,void 0!=c.children))for(var d=0;d<c.children.length;d++)g(c.children[d],a)}function x(c,a){if(void 0!=c.children){for(var d=0;d<c.children.length;d++)a.push(c.children[d]);for(d=0;d<c.children.length;d++)x(c.children[d],a)}return a}function n(c){return 10>c?"0"+
        c:c.toString()}function f(c,a){if(a){var d=~~(ba/L);l=Math.max(0,L*(d-20));u=Math.min(G,L*d);var f=u-l,e=r*ca;d=(X-f*e)/(G-(u-l));var M=l*d+(c-l)*e;f=l*d+f*e+(c-u)*d;return c<l?c*d:c>u?f:M}return c*ca}d3.select(a).selectAll("*").remove();var C=[],q=p.getdatabyProcessName,w=[],ea=q.map(function(c){return c.key});b.forEach(function(c){for(var d=0;d<ea.length;d++)c.targetProcessName&&w.push(c)});for(var z=UpdateProcessNameWithChild(q,w),m=0;m<z.length;m++){z[m].children=[];for(a=0;a<z[m].childs.length;a++)z[m].children.push(z[z[m].childs[a]]);
        z[m].children.sort(function(c,d){return c.childs.length<d.childs.length?-1:c.childs.length>d.childs.length?1:c.values[0].Step<d.values[0].Step?1:c.values[0].Step>d.values[0].Step?-1:0})}z.sort(function(c,d){return x(c,[]).length<x(d,[]).length?1:x(c,[]).length>x(d,[]).length?-1:c.values[0].Step<d.values[0].Step?-1:c.values[0].Step>d.values[0].Step?1:0});orderedArray=[];for(m=0;m<z.length;m++)g(z[m],orderedArray);q.forEach(function(c){c.position=getProcessNameIndex(orderedArray,c.key)});q=q.sort(function(c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     d){return c.position-d.position});m=30*q.length;a=d3.nest().key(function(c){return c.library}).entries(b);a=a.filter(function(c){if("undefined"!=c.key&&10<c.values.length)return c});var k=[];a.forEach(function(c){k.push(c.key)});a=a.sort(function(c,d){return d.values.length-c.values.length});a=make2Darray(q.length,a.length);b.sort(function(c,d){return c.currenttimestamp-d.currenttimestamp});var G=O-A,fa=1E5*~~(G/1E6),aa=[],U=[],ba=-1E3;d3.select("#loading").remove();d3.select("#legend").selectAll("*").remove();
        var H=d3.select("#legend").append("svg").attr("width",150).attr("height",120).append("g").attr("id","legend").attr("transform","translate(20,0)");H.selectAll("circle").data(stackColor).enter().append("circle").attr("cx",0).attr("cy",function(c,d){return 10+20*d}).attr("r",6).attr("fill",function(c){return c});H.selectAll(".textLegend").data(categories).enter().append("text").attr("class","textLegend").text(function(c){return c}).attr("font-size","15px").attr("x",20).attr("y",function(c,d){return 15+
            20*d});(function(){for(var c=0;11>c;c++){var d=(A+c*fa)/1E5,a=~~(d/3600),f=~~((d-3600*a)/60);d={hour:a,minute:f,second:~~(d-3600*a-60*f)};a=d.hour.toString()+":"+n(d.minute)+":"+n(d.second);f=1E5*(3600*d.hour+60*d.minute+d.second)-A;U.push(f);aa.push({time:a,stamp:d,step:f})}})();H=m+30;var I=document.getElementById("heatmap").getBoundingClientRect().width,P=d3.select("#heatmap").append("svg").attr("class","outline").attr("height",H).attr("width",I-35).attr("id","outline");v=document.getElementById("outline").getBoundingClientRect().width;
        var X=v-120;I=[];for(var ha=(U[1]-U[0])/50,Y=0;Y<U.length;Y++)for(var V=0;50>V;V++)I.push({step:U[Y]+V*ha,main:0===V?!0:!1});var ca=X/G,L=1E5*~~(G/1E6)/50;P.selectAll(".verticalBars").remove();P.append("g").attr("id","verticalGroup").selectAll(".verticalBars").data(I).enter().append("line").attr("class","verticalBars").attr("id",function(c,a){return"timestep"+a}).attr("x1",function(c){return f(c.step)+30}).attr("x2",function(c){return f(c.step)+30}).attr("y1",0).attr("y2",H).style("stroke","black").style("stroke-opacity",
            function(c,a){return c.main?.4:0}).style("stroke-width",1).style("stroke-dasharray",function(c,a){return c.main?"3,2":"1,3"});d3.select("#verticalGroup").append("line").attr("id","endStep").attr("x1",v).attr("x2",v).attr("y1",0).attr("y2",H).style("stroke","black").style("stroke-opacity","0.4").style("stroke-width",1).style("stroke-dasharray","3, 2");var B=P.append("svg").attr("id","processes").attr("margin-left","20px").attr("width",v).attr("height",m).attr("border",1).attr("y","40"),D=P.append("svg").attr("class",
            "timeBox").attr("height",30).attr("width",v).attr("id","svgTimeBox");D.append("rect").style("fill","#ffffff").style("fill-opacity",.8).attr("height",30).attr("width",v);D.selectAll("text").data(aa).enter().append("text").attr("id",function(a,d){return"timestep"+d}).attr("y",20).attr("x",function(a,d){return f(a.step)+30}).text(function(a){return a.time}).attr("fill","black").attr("font-family","sans-serif").attr("font-size","13px").attr("text-anchor","start");D.append("rect").style("fill","#aaa").style("fill-opacity",
            .3).attr("height",30).attr("width",v).on("mousemove",function(){if(lensingStatus){var a=[0,0];a=d3.mouse(this);ba=Math.max(0,a[0])*G/X;B.selectAll("rect").attr("x",function(a){return 1*f(a.Step,!0)+30});D.selectAll("text").attr("x",function(a,c){return f(a.step,!0)+30});orderedArray.forEach(function(a,c){0<a.children.length&&a.children.forEach(function(d,e){a.childInfo[d.key].forEach(function(a,b){B.selectAll(".path_"+c+"_"+e+"_"+b).attr("transform",function(){var e=1*f(a.step,!0)+30,M=30*(getProcessNameIndex(z,
            d.key)+c)/2+15;return"translate("+e+","+M+")"})})});0<a.selfCalls.length&&a.selfCalls.forEach(function(d,e){B.selectAll(".path_"+c+"_"+c+"_"+e).attr("transform",function(){var e=1*f(d.step,!0)+30-9,b=30*(getProcessNameIndex(z,a.key)+c)/2+15;return"translate("+e+","+b+")"})})});B.selectAll(".stream").attr("d",S.x(function(a,c){return f(E(c),!0)+30}));q.forEach(function(a,c){B.selectAll(".malName"+c).attr("x",function(){return 1*f(a.values[a.values.length-1].Step,!0)+35}).attr("y",15)});P.selectAll(".verticalBars").attr("x1",
            function(a){return f(a.step,!0)+30}).attr("x2",function(a){return f(a.step,!0)+30}).style("stroke-opacity",function(a,c){return a.main?.4:a.step<l?0:a.step>u?0:.2}).style("stroke-width",1).style("stroke-dasharray",function(a,c){return a.main?"3,2":"1,3"})}});var J,Z=0,N=0,da=function(a,d){var c={Registry:0,Network:0,File:0,exe:0,dll:0};d.forEach(function(a){a.binStep=Math.round(a.Step/2E4)});J=d3.max(d,function(a){return a.binStep});return a.map(function(a){a.values.forEach(function(a){a.binStep=
            Math.round(a.Step/2E4)});a.values.forEach(function(a){});var e=d3.nest().key(function(a){return a.binStep}).entries(a.values.filter(function(a){return 0<a.Path.length}));e.forEach(function(a){a.group={Registry:0,Network:0,File:0,exe:0,dll:0};var e=d3.nest().key(function(a){return a.Process}).rollup(function(a){return a.length}).entries(a.values);a.group.Registry=e.find(function(a){return"Registry"===a.key})?e.find(function(a){return"Registry"===a.key}).value:0;a.group.Network=e.find(function(a){return"Network"===
            a.key})?e.find(function(a){return"Network"===a.key}).value:0;a.values.filter(function(a){return"Registry"!==a.Process&&"Network"!==a.Process}).forEach(function(e){e.Path.endsWith(".exe")?a.group.exe+=1:e.Path.endsWith(".dll")?a.group.dll+=1:a.group.File+=1});categories.forEach(function(e){a.group[e]>Z&&(Z=a.group[e]);a.group[e]<N&&(N=a.group[e])})});a.calls=[];for(var M=0;M<J+1;M++)a.calls.push(e.find(function(a){return a.key==M})?e.find(function(a){return a.key==M}).group:c);return{process:a.key,
            calls:a.calls}})}(q,b),E=d3.scaleLinear().domain([0,J]).range([0,y]);d3.scalePoint().domain(d3.range(da.length)).range([0,m]);var T=d3.scaleSqrt().domain([N,Z]).range([-11,11]),ia=d3.stack().keys(categories).offset(d3.stackOffsetSilhouette),S=d3.area().x(function(a,d){return f(E(d))+30}).y0(function(a){return T(a[0])}).y1(function(a){return T(a[1])}).curve(d3.curveCatmullRom);q.forEach(function(a,d){var c=B.append("g").attr("transform","translate(0,"+30*d+")");c.append("line").attr("stroke-dasharray",
            "2, 5").attr("stroke","black").attr("stroke-width",.5).attr("x1",1*f(t)+40).attr("y1",15).attr("x2",1*f(y)+40).attr("y2",15);var b=a.values.filter(function(a){if(a.hasOwnProperty("library")&&1==k.includes(a.library))return a});d3.nest().key(function(a){return a.library}).entries(b).forEach(function(a){var e={};e.source=d;e.target=k.indexOf(a.key);e.value=a.values;C.push(e)});b=ia(da[d].calls);c.selectAll("path").data(b).enter().append("path").attr("transform","translate(0,24.5)").attr("class","stream").attr("d",
            S).attr("fill",function(a,e){return stackColor[e]});var e;c.append("text").attr("class","malName"+d).text(a.key.slice(0,30)).attr("x",function(){return 1*f(a.values[a.values.length-1].Step)+35}).attr("y",15).attr("text-anchor","start").classed("linkText",!0).on("mouseover",function(){d3.select(d3.event.target).classed("op1",!0)}).on("mouseout",function(){d3.select(d3.event.target).classed("op1",!1)}).on("click",function(){d3.selectAll(".arc").classed("hidden",!e).classed("visible",!!e);d3.selectAll("[class*=a"+
            a.key.split(".").join("")+"]").classed("visible",!e).classed("hidden",!1).raise();e=!e});c.selectAll("rect").data(a.values).enter().append("rect").attr("class",function(a,e){return a.Operation.replace(" ","")}).attr("x",function(a,e){return 1*f(a.Step)+30}).attr("group","detail").attr("id",function(a){return a.Step}).attr("y",function(a){if(a.hasOwnProperty("VirusTotal")){if(0<a.VirusTotal.malicious)return 0}else return 2.5}).attr("width",1).attr("height",function(a){if(a.hasOwnProperty("VirusTotal")){if(0<
            a.VirusTotal.malicious)return 30}else return 22}).style("fill-opacity",.4).attr("fill",function(a){return colorPicker(a.Operation)}).style("visibility",function(a){return"Profiling"!==a.Process?"visible":"hidden"}).on("mouseover",function(a){"UDP Send"==a.Operation&&a.hasOwnProperty("VirusTotal")?(div.transition().duration(200).style("opacity",1).style("width","250px"),div.html('<table><tr><td colspan="4">Source: https://www.virustotal.com</td></tr><tr><td><img src="images/clean.png" width="20" height="20"/></td><td> Clean ('+
            a.VirusTotal.harmless+')</td><td><img src="images/malicious.png" width="20" height="20"/></td><td><font color="red"><b>Malicious ('+a.VirusTotal.malicious+')</b> </font></td></tr><tr><td><img src="images/suspicious.png" width="20" height="20"/></td><td> Suspicious ('+a.VirusTotal.suspicious+')</td><td><img src="images/question.png" width="20" height="20"/></td><td> Undetected ('+a.VirusTotal.undetected+')</td></tr><tr><td colspan="4">Target domain: '+a.Domain+'</td></tr><td colspan="4">Connecting time: '+
            a.Timestamp+"</td></tr></table>").style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")):(div2.transition().duration(100).style("opacity",1),div2.html("<table><col width='80'><tr><td>Program</td><td class ='bold'>"+a.Process_Name+"</td></tr><tr><td>Operation</td><td class ='bold' style='color: "+colorPicker(a.Operation)+";'>"+a.Operation+"</td></tr><tr><td>Event type</td><td>"+a.Process+"</td></tr><tr><td>Timestamp</td><td >"+a.Timestamp+"</td></tr><tr><td>Path</td><td>"+a.Path+"</td></tr><tr><td>Detail</td><td>"+
            a.Detail+"</td></tr><tr><td>PID</td><td>"+a.PID+"</td></tr></table>").style("left",d3.event.pageX+20+"px").style("top",d3.event.pageY+20+"px").style("pointer-events","none"))}).on("click",function(a){d3.selectAll("path.detail_path").style("opacity",0);d3.selectAll('path[source="'+getProcessNameIndex(z,a.Process_Name)+'"]').style("opacity",1)}).on("mouseout",function(a){div2.transition().duration(100).style("opacity",0)})});P.on("mouseleave",function(){P.selectAll(".verticalBars").attr("x1",function(a){return f(a.step)+
            30}).attr("x2",function(a){return f(a.step)+30}).style("stroke-opacity",function(a,d){return a.main?.4:0}).style("stroke-width",1).style("stroke-dasharray",function(a,d){return a.main?"3,2":"1,3"});B.selectAll("rect").attr("x",function(a){return 1*f(a.Step)+30});D.selectAll("text").attr("x",function(a,d){return f(a.step)+30});orderedArray.forEach(function(a,d){0<a.children.length&&a.children.forEach(function(c,b){a.childInfo[c.key].forEach(function(a,g){B.selectAll(".path_"+d+"_"+b+"_"+g).attr("transform",
            function(){var e=1*f(a.step)+30,b=30*(getProcessNameIndex(z,c.key)+d)/2+15;return"translate("+e+","+b+")"})})});0<a.selfCalls.length&&a.selfCalls.forEach(function(c,b){B.selectAll(".path_"+d+"_"+d+"_"+b).attr("transform",function(){var e=1*f(c.step)+30-9,b=30*(getProcessNameIndex(z,a.key)+d)/2+15;return"translate("+e+","+b+")"})})});B.selectAll(".stream").attr("d",S.x(function(a,d){return f(E(d))+30}));q.forEach(function(a,d){B.selectAll(".malName"+d).attr("x",1*f(a.values[a.values.length-1].Step)+
            35).attr("y",15)})});orderedArray.forEach(function(a,d){0<a.children.length&&a.children.forEach(function(c,b){B.append("svg:defs").selectAll(".arrow").data(a.childInfo[c.key]).enter().append("svg:marker").attr("id",function(a,e){return"arrow_"+d+"_"+b+"_"+e}).attr("class","arrow").attr("refX",6).attr("refY",4).attr("markerWidth",8).attr("markerHeight",8).style("fill",function(a){return colorPicker(a.event)}).attr("orient",0).append("path").attr("d","M0,0 L0,8 L8,4 z");var e=getProcessNameIndex(z,
            c.key)-d;a.childInfo[c.key].forEach(function(g,k){B.append("path").attr("class",function(){return"arc a"+a.key.split(".").join("")+"_a"+c.key.split(".").join("")+" path_"+d+"_"+b+"_"+k+" o"+g.event.replace(" ","")}).attr("id","path_"+d+"_"+b+"_"+k).attr("d",d3.arc().innerRadius(30*Math.abs(e)/2-1).outerRadius(30*Math.abs(e)/2).startAngle(0<e?-Math.PI:Math.PI/90).endAngle(0<e?Math.PI/90:-Math.PI)).attr("fill",colorPicker(g.event)).attr("source",d).attr("target",getProcessNameIndex(z,c.key)).attr("transform",
            function(){var a=1*f(g.step)+30,e=30*(getProcessNameIndex(z,c.key)+d)/2+15;return"translate("+a+","+e+")"}).attr("marker-end","url(#arrow_"+d+"_"+b+"_"+k+")").on("mouseover",function(){h||(d3.selectAll(".arc").classed("visible",!1).classed("hidden",!0),d3.select(".path_"+d+"_"+b+"_"+k).classed("visible",!0).classed("hidden",!1));div3.transition().style("opacity",1);div3.html('Source: <text class = "bold">'+a.key+'</text><br/> Operation: <text class = "bold">'+g.event+'</text><br/> Target: <text class = "bold">'+
            c.key+"</text>").style("left",d3.event.pageX+20+"px").style("top",d3.event.pageY-30+"px").style("pointer-events","none").style("background-color",function(){return"#dddddd"})}).on("mouseout",function(){h?d3.selectAll(".arc.visible").classed("visible",!0).classed("hidden",!1):d3.selectAll(".arc").classed("visible",!0).classed("hidden",!1);div3.style("opacity",0)})})});0<a.selfCalls.length&&a.selfCalls.forEach(function(c,b){B.append("svg:defs").selectAll(".arrow").data([c]).enter().append("svg:marker").attr("id",
            function(){return"arrow_"+d+"_"+d+"_"+b}).attr("class","arrow").attr("refX",4).attr("refY",6).attr("markerWidth",8).attr("markerHeight",8).style("fill",function(a){return colorPicker(a.event)}).attr("orient",-150).append("path").attr("d","M0,0 L8,0 L4,8 z");B.append("path").attr("class",function(){return"arc a"+a.key.split(".").join("")+" path_"+d+"_"+d+"_"+b+" o"+c.event.replace(" ","")}).attr("id","path_"+d+"_"+d+"_"+b).attr("d",d3.arc().innerRadius(14).outerRadius(15).startAngle(Math.PI/180*100).endAngle(7)).attr("marker-end",
            "url(#arrow_"+d+"_"+d+"_"+b+")").attr("fill",colorPicker(c.event)).attr("source",d).attr("target",d).attr("transform",function(){var e=1*f(c.step)+30-9,b=30*(getProcessNameIndex(z,a.key)+d)/2+15;return"translate("+e+","+b+")"}).on("mouseover",function(){h||(d3.selectAll(".arc").classed("visible",!1).classed("hidden",!0),d3.select(".path_"+d+"_"+d+"_"+b).classed("visible",!0).classed("hidden",!1));div3.transition().style("opacity",1);div3.html('Self-called: <text class = "bold">'+a.key+'</text><br/> Operation: <text class = "bold">'+
            c.event+"</text>").style("left",d3.event.pageX+20+"px").style("top",d3.event.pageY-30+"px").style("pointer-events","none").style("background-color",function(){return"#dddddd"})}).on("mouseout",function(){h?d3.selectAll(".arc.visible").classed("visible",!0).classed("hidden",!1):d3.selectAll(".arc").classed("visible",!0).classed("hidden",!1);div3.style("opacity",0)})})});for(m=0;m<C.length;m++)I={},I.source=C[m].source,I.target=C[m].target,I.value=C[m].value,a[C[m].source][C[m].target]=I;K=q;a=d3.select("#outline").append("g").attr("transform",
            "translate(40,0)").attr("id","lensingGroup").on("click",setLensing);a.append("rect").attr("id","lensingBtn").attr("class","textClick").attr("transform","translate(0,"+(H-32)+")");a.append("text").text("Lensing").classed("unselectable",!0).classed("linkText",!0).attr("font-size","14px").attr("transform","translate(7,"+(H-14)+")");a=a.append("g").attr("id","magContainer").attr("transform","translate(90,"+(H-43)+")").style("display","none");a.append("svg:text").attr("display","inline-block").append("svg:tspan").attr("x",
            0).attr("dy",28).text("Magnification: ").attr("font-size","14px").append("svg:tspan").attr("id","sliderValue").attr("x",100).attr("dy",0).text("x"+r).attr("font-size","14px");var Q=a.append("g").attr("display","inline-block").attr("class","slider").attr("transform","translate(140, 20)"),F=d3.scaleLinear().domain([5,30]).range([0,200]).clamp(!0);Q.append("line").attr("class","track").attr("x1",F.range()[0]).attr("x2",F.range()[1]).select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class",
            "track-inset").select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","track-overlay").call(d3.drag().on("start.interrupt",function(){Q.interrupt()}).on("start drag",function(){var a=F.invert(d3.event.x);R.attr("cx",F(a));r=a;d3.select("#sliderValue").text(a.toFixed(0))}));Q.insert("g",".track-overlay").attr("class","ticks").attr("transform","translate(0,17)").selectAll("text").data(F.ticks(6)).enter().append("text").attr("x",F).attr("text-anchor","middle").text(function(a){return a});
        var R=Q.insert("circle",".track-overlay").attr("class","handle").attr("r",7).attr("cx",F(r))},malist:function(a){var b=p.getdatabyOperation.map(function(a){return a.key});availableCommon=[];var x="CreateFile;CreateFileMapping;DeviceIoControl;FileSystemControl;InternalDeviceIoControl;RegOpenKey;System Statistics;SystemControl;TCP Accept;TCP Connect;TCP Send;UDP Accept;UDP Connect;UDP Send".split(";");b.forEach(function(a){x.forEach(function(b){a===b&&availableCommon.push(a)})});d3.select(a).selectAll("*").remove();
        var n={},f=d3.select("#commonOp").append("svg").attr("width","100%").attr("height",30+30*availableCommon.length);a=f.append("g").append("text").style("font-style","italic").style("font-size","12px");a.append("tspan").text("Reference: ").attr("fill","black").attr("y",10);a.append("tspan").text("Infosec Institute.").attr("fill","blue").attr("class","linkText").on("click",function(){window.open("https://resources.infosecinstitute.com/windows-functions-in-malware-analysis-cheat-sheet-part-1/")});availableCommon.forEach(function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          b){var g=a.replace(" ","");g=f.append("g").attr("id","cg"+g).attr("transform","translate(10,"+(30+28*b)+")").attr("class","linkText commonAll op1");g.append("rect").attr("x",2).attr("width","16").attr("height","16").attr("fill",colorPicker(a));g.append("text").text(a).attr("dx","25px").attr("y","13px").style("color","black").style("font-size","14px").classed("linkText",!0);g.on("click",function(){var b=a.replace(" ","");n[b]?(document.getElementById("opSelection").checked=!0,d3.select("#heatmap").selectAll("rect[group=detail]").style("visibility",
            "visible"),d3.selectAll(".arc").classed("visible",!0).classed("hidden",!1),svgStats.selectAll("rect").classed("op1",!0).classed("op0 op2",!1).classed("greyFill",!1),d3.selectAll(".commonAll").classed("op1",!1),d3.select(this).classed("op1",!1),d3.selectAll(".commonAll").classed("greyFill",!1)):(document.getElementById("opSelection").checked=!1,document.getElementById("commonSelection").checked=!1,d3.select("#heatmap").selectAll("rect[group=detail]").style("visibility","hidden"),d3.selectAll(".arc").classed("hidden",
            !0),svgStats.selectAll("rect").classed("op0",!0).classed("op1 op2",!1).classed("greyFill",!0),d3.selectAll(".commonAll").classed("op1",!1).classed("greyFill",!0),d3.select("#heatmap").selectAll("rect."+b).style("visibility","visible").raise(),h=d3.selectAll("[class*=o"+b+"]"),h.classed("visible",!n[b]).classed("hidden",!!n[b]).raise(),d3.select("#ovRect"+b).classed("op1",!0).classed("op2",!1).classed("greyFill",!1).classed("op0",!!n[b]),d3.select(this).classed("op1",!0).classed("greyFill",!1),d3.select("[class*=g"+
            b+"]").classed("op1",!0));n[b]=!n[b]})})},highlight:function(a){d3.select(a).selectAll("*").remove();var b=K.map(function(a){return a.key.toLowerCase()}),h=b.length,n={},f={},C={},q={},l={},p={};K.forEach(function(a,g){var k=a.key.toLowerCase();p[k]={};var q=p[k],m={};n[k]=[];f[k]=[];l[k]=[];a.values.forEach(function(a){if(0<a.Path.length)if("Registry"===a.Process)computeNodes(q,n[k],"Registry",a.Path,g,h);else if("Network"===a.Process)computeNodes(q,n[k],"Network",a.Path,g,h);else if(a.Path.toLowerCase().endsWith(".dll"))computeNodes(q,
        n[k],"dll",a.Path,g,h);else if(a.Path.toLowerCase().endsWith(".exe")){a=a.Path.split(/\\/);var f=a[a.length-1];computeNodes(q,n[k],"exe",f,g,h);b.forEach(function(a){a.toLowerCase()===k||m[a]||f.toLowerCase()!==a.toLowerCase()||(l[k].push(a),m[a]=!0)})}else computeNodes(q,n[k],"File",a.Path,g,h)});q[k]||n[k].push({id:k,type:"exe",connect:Array(h+1).join("0")});d3.keys(q).forEach(function(a){f[k].push({source:k,target:a,value:q[a]})})});b.forEach(function(a){0<l[a].length&&l[a].forEach(function(g){d3.keys(p[a]).forEach(function(k){if(p[g][k]){var h=
        getIndex(b,g),q=n[a].find(function(a){return a.id===k}).connect,m=n[a].find(function(b){return b.id===a}).connect;n[a].find(function(a){return a.id===k}).connect=q.slice(0,h)+"1"+q.slice(h+1);n[a].find(function(b){return b.id===a}).connect=m.slice(0,h)+"1"+m.slice(h+1);f[a].push({source:g,target:k,value:f[g].find(function(a){return a.target===k}).value})}})})});a=b.sort(function(a,b){return f[b].length-f[a].length});var w=d3.scaleSqrt().domain([1,5E3]).range([1,10]),m=d3.scaleSqrt().domain([4,1200]).range([4,
        50]);d3.select("#ranked").selectAll("*").remove();a.forEach(function(a,g){function h(a){return K(a.path)}function k(){A&&A.stop();r=network(z,r,getGroup,u);G=r.links.filter(function(a){return!a.img}).length;l=scaleHeight(G);v=l/2;F?d3.select("#svg"+a.replace(/[.]/g,"")).transition().duration(200).attr("height",l):(d3.select("#svg"+a.replace(/[.]/g,"")).attr("height",l),F=!0);A=d3.forceSimulation().force("link",d3.forceLink().distance(function(a){if(a.self)return 15;var e=a.source;a=a.target;var c=
        20+Math.min(20*Math.min(e.size||(e.group!=a.group?e.group_data.size:0),a.size||(e.group!=a.group?a.group_data.size:0)),-30+30*Math.min(e.link_count||(e.group!=a.group?e.group_data.link_count:0),a.link_count||(e.group!=a.group?a.group_data.link_count:0)),100);return e.size&&a.size?0<=b.indexOf(e.nodes[0].id)&&0<=b.indexOf(a.nodes[0].id)?120:c:!e.size&&a.size?0<=b.indexOf(e.id)&&0<=b.indexOf(a.nodes[0].id)?120:c:e.size&&!a.size?0<=b.indexOf(e.nodes[0].id)&&0<=b.indexOf(a.id)?120:c:0<=b.indexOf(e.id)&&
    0<=b.indexOf(a.id)?120:c}).strength(function(a){var e=a.source;a=a.target;return e.size&&a.size?0<=b.indexOf(e.nodes[0].id)&&0<=b.indexOf(a.nodes[0].id)?.3:.8:!e.size&&a.size?0<=b.indexOf(e.id)&&0<=b.indexOf(a.nodes[0].id)?.3:.8:e.size&&!a.size?0<=b.indexOf(e.nodes[0].id)&&0<=b.indexOf(a.id)?.3:.8:0<=b.indexOf(e.id)&&0<=b.indexOf(a.id)?.3:.8})).force("center",d3.forceCenter(p,v)).force("charge",d3.forceManyBody().strength(function(a){return a.dummy?-200:-80})).force("collide",d3.forceCollide().radius(8).strength(.4)).velocityDecay(.4).on("tick",
        function(){L.empty()||L.data(convexHulls(r.nodes,getGroup,6)).attr("opacity",1).attr("d",h);B.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y});J.attr("d",function(a){return f([[a.source.x,a.source.y],[a.dummy1.x,a.dummy1.y],[a.dummy2.x,a.dummy2.y],[a.target.x,a.target.y]])});D.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y})});A.nodes(r.nodes);A.force("link").links(r.links);
        T.selectAll("path.hull").remove();L=T.selectAll("path.hull").data(convexHulls(r.nodes,getGroup,6)).enter().append("path").attr("class","hull").attr("d",h).style("fill",function(a){return getColor(a.type)}).style("fill-opacity",0).on("click",function(a){console.log("hull click",a,arguments,this,u[a.group]);var b=$jscomp.makeIterator(getCentroidFromHull(r.nodes.filter(function(b){return b.group==a.group})));d=b.next().value;W=b.next().value;u[a.group]=!1;k()}).transition().duration(200).style("fill-opacity",
            .3);L=T.selectAll("path.hull");J=S.selectAll("path.curve").data(r.extra,function(a){return a.pathid});J.exit().remove();J.enter().append("path").attr("class","curve link").style("stroke-width",function(a){return a.img?0:Math.min(w(a.size),20)}).attr("fill","none");J=S.selectAll("path.curve");B=O.selectAll("line.link").data(r.links,linkid);B.exit().remove();B.enter().append("line").attr("class","link").attr("x1",R).attr("y1",c).attr("x2",R).attr("y2",c).style("stroke-width",function(a){return a.img?
            0:Math.min(w(a.size),20)});B=O.selectAll("line.link");D=Q.selectAll("circle.node").data(r.nodes,nodeid);D.exit().transition().duration(200).attr("r",1E-6).attr("cx",d).attr("cy",W).remove();D.transition().duration(600).attr("fill",function(a){return a.size?getColor(a.nodes[0].type):getColor(a.type)}).attr("r",function(a){return a.size?Math.min(m(a.size+4),60):Math.min(m(5),60)});D.enter().append("circle").attr("class",function(b){return b.size?1===b.size?b.nodes[0].id===a?"node main":"node leaf":
            "node":b.id===a?"node main":"node leaf"}).attr("r",function(a){return a.size?Math.min(m(a.size+4),60):Math.min(m(5),60)}).attr("fill",function(a){return a.size?getColor(a.nodes[0].type):getColor(a.type)}).attr("cx",R).attr("cy",c).attr("opacity",1).attr("visibility",function(a){return a.dummy?"hidden":"visible"}).merge(D).on("click",function(a){console.log("node click",a,arguments,this,u[a.group]);var b=d3.select(this);"node"===b.attr("class")?(R=b.attr("cx"),c=b.attr("cy"),u[a.group]=!u[a.group],
            k()):a.id&&(b=$jscomp.makeIterator(getCentroidFromHull(r.nodes.filter(function(b){return b.group==a.group}))),d=b.next().value,W=b.next().value,u[a.group]=!u[a.group],k())});D=Q.selectAll("circle.node");D.call(d3.drag().on("start",function(a){d3.event.active||A.alphaTarget(.5).restart();a.fx=a.x;a.fy=a.y}).on("drag",function(a){a.fx=d3.event.x;a.fy=d3.event.y}).on("end",function(a){d3.event.active||A.alphaTarget(0);a.fx=null;a.fy=null}));var f=d3.line().curve(d3.curveNatural)}C[a]=[];var l=scaleHeight(f[a].length),
        p=sideWidth/2,v=l/2,x={},t=n[a].groupBy(["type","connect"]);t.forEach(function(b,c){x[c+1]=0;b.values.forEach(function(b){x[c+1]+=1;b.group=c+1;delete b.connect;C[a].push(b)})});var y=t.length;C[a].forEach(function(a){var c=a.group;0<=b.indexOf(a.id)&&1<x[a.group]&&(y+=1,a.group=y,t[c-1].values=t[c-1].values.filter(function(b){return b.id!==a.id}))});t.forEach(function(b,c){for(var d=b.values.length,e=0;e<d;e++)for(var g=b.values[e],h=e+1;h<d;h+=Math.min(scaleLimit(d),Math.round(d/3)))f[a].push({source:g.id,
        target:b.values[h].id,value:1,img:!0})});var u={},z={},r,A,L,B,D,J,K=d3.line().curve(d3.curveCardinalClosed),N=d3.select("#ranked").append("svg").attr("id","svg"+a.replace(/[.]/g,"")).attr("width","100%").attr("height",l);N.append("rect").attr("width","100%").attr("height","100%").attr("stroke","grey").attr("fill","white");N.append("text").text(g+1+". "+a).attr("x",15).attr("y",23).style("font-weight","bold").append("tspan").attr("dy",25).attr("x",8<g?35:30).style("font-size","14px").text("Self-call(s): "+
        orderedArray.find(function(b){return b.key===a}).selfCalls.length).style("font-weight","normal");q[a]=[];f[a].forEach(function(b){var c=b.source=C[a].find(function(a){return a.id===b.source}),d=b.target=C[a].find(function(a){return a.id===b.target});if(d.id===c.id){var g={},h={};y+=1;g.id="dummy1"+d.id;g.dummy=!0;g.group=y;y+=1;h.id="dummy2"+d.id;h.dummy=!0;h.group=y;C[a].push(g,h);f[a].push({source:c,target:g,self:1,value:1},{source:g,target:h,self:2,value:1},{source:h,target:d,self:1,value:1});
        q[a].push({source:c,dummy1:g,dummy2:h,target:d,value:b.value})}});z.nodes=C[a];z.links=f[a];z.extra=q[a];var G,E=N.append("g");var T=E.append("g");var O=E.append("g");var S=E.append("g");var Q=E.append("g");var F=!1;d3.zoom().on("zoom",function(){E.attr("transform",d3.event.transform)})(E);var R=p,c=v,d=R,W=c;k();N.attr("opacity",1E-6).transition().duration(1E3).attr("opacity",1)})},connectedDomain:function(){var a=p.getdatabyDomain;if(0===d3.keys(a).length)d3.select("#domainBox").style("display",
        "none");else if(1===d3.keys(a).length){d3.select("#domainBox").selectAll("span").remove();d3.select("#domainBox").style("display","block");document.getElementById("domainList").style.visibility="hidden";document.getElementById("titleDomain").innerHTML="Connecting Domain: ";var b=document.createElement("span");b.textContent=d3.keys(a)[0];document.getElementById("firstCell").appendChild(b);document.getElementById("downArrow").style.display="none"}else{d3.select("#domainBox").style("display","block");
        d3.select("#domainBox").selectAll("span").remove();b=document.getElementById("domainList");document.getElementById("titleDomain").innerHTML="Connecting Domains: ";b.style.visibility="visible";var h=1,l;for(l in a){if(1===h){var f=document.createElement("span");f.textContent=d3.keys(a)[0];document.getElementById("firstCell").appendChild(f);document.getElementById("downArrow").style.display="block"}else f=document.createElement("span"),f.classList.add("w3-bar-item"),f.textContent=l,f.style.width="160px",
            b.appendChild(f);h+=1}}}}}var orderedArray;function getColor(b){return stackColor[categories.indexOf(b)]}function setLensing(){if(lensingStatus)return document.getElementById("lensingBtn").classList.remove("selected"),d3.select("#magContainer").style("display","none"),lensingStatus=!lensingStatus,!1;document.getElementById("lensingBtn").classList.add("selected");d3.select("#magContainer").style("display","block");lensingStatus=!lensingStatus;return!0}
function selectAll(){var b=document.getElementById("opSelection").checked;firstClick=!0;b?(document.getElementById("commonSelection").checked=!1,d3.select("#heatmap").selectAll("rect[group=detail]").style("display","block").style("visibility","visible"),d3.selectAll(".arc").classed("hidden",!1).classed("visible",!0),d3.select("#overview").selectAll("rect").classed("op1",!0).classed("op0 op2",!1),svgStats.selectAll("rect").classed("greyFill",!1),d3.selectAll(".commonAll").classed("op1",!0).classed("greyFill",
    !1),operationShown.forEach(function(b){active[b]=!0})):(d3.select("#heatmap").selectAll("rect[group=detail]").style("visibility","hidden"),d3.selectAll(".arc").classed("hidden",!0).classed("visible",!1),d3.select("#overview").selectAll("rect").classed("op0",!0).classed("op1 op2",!1),d3.selectAll(".commonAll").classed("op1",!1).classed("greyFill",!0),operationShown.forEach(function(b){active[b]=!1}))}var prevStatus;
function selectCommon(){document.getElementById("commonSelection").checked?(prevStatus=JSON.parse(JSON.stringify(active)),document.getElementById("opSelection").checked=!1,d3.select("#heatmap").selectAll("rect[group=detail]").style("visibility","hidden"),d3.selectAll(".arc").classed("hidden",!0),svgStats.selectAll("rect").classed("op0",!0).classed("op1 op2",!1).classed("greyFill",!0),availableCommon.forEach(function(b){b=b.replace(" ","");d3.select("#ovRect"+b).classed("op1",!0).classed("op2",!1).classed("greyFill",
    !1).classed("op0",!!active[b]);d3.selectAll("[class*=o"+b+"]").classed("visible",!0).classed("hidden",!1);d3.select("#heatmap").selectAll("rect."+b).style("visibility",active[b]?"hidden":"visible");active[b]=!active[b]})):(document.getElementById("opSelection").checked=!0,selectAll())}function computeNodes(b,h,w,t,y,v){t=t.toLowerCase();v=Array(v+1).join("0");b[t]?b[t]+=1:(b[t]=1,h.push({id:t,type:w,connect:v.slice(0,y)+"1"+v.slice(y+1)}))}function getIndex(b,h){return b.indexOf(h)}
function nodeid(b){return b.size?"_g_"+b.group:b.id}function linkid(b){var h=nodeid(b.source);b=nodeid(b.target);return h<b?h+"|"+b:b+"|"+h}function getGroup(b){return b.group}function convexHulls(b,h,w){for(var t={},y={},v=0;v<b.length;++v){var l=b[v];if(!l.size){var u=h(l),r=t[u]||(t[u]=[]);y[u]=l.type;r.push([l.x-w,l.y-w]);r.push([l.x-w,l.y+w]);r.push([l.x+w,l.y-w]);r.push([l.x+w,l.y+w])}}b=[];for(u in t)b.push({group:u,path:d3.polygonHull(t[u]),type:y[u]});return b}
function getCentroidFromHull(b){var h=0,w=0,t=b.length;b.forEach(function(b){h+=b.x;w+=b.y});return[h/t,w/t]}
function network(b,h,w,t){t=t||{};var y={},v={},l={},u={},r={},A=[],O=[],K=[];h&&h.nodes.forEach(function(a){var b=w(a);0<a.size?(u[b]=a,a.size=0):(b=r[b]||(r[b]={x:0,y:0,count:0}),b.x+=a.x,b.y+=a.y,b.count+=1)});for(h=0;h<b.nodes.length;++h){var p=b.nodes[h],a=w(p),g=y[a]||(y[a]=u[a])||(y[a]={group:a,size:0,nodes:[]});p.dummy&&(g.dummy=!0);t[a]?(v[p.id]=A.length,A.push(p),u[a]&&(p.x=u[a].x+3*Math.random(),p.y=u[a].y+3*Math.random())):(0==g.size&&(v[a]=A.length,A.push(g),r[a]&&(g.x=r[a].x/r[a].count+
    3*Math.random(),g.y=r[a].y/r[a].count+3*Math.random())),g.nodes.push(p));g.size+=1;p.group_data=g}for(a in y)y[a].link_count=0;b.extra.forEach(function(a,b){K.push({source:A.find(function(b){return 1==b.size&&b.nodes[0].id===a.source.id}),target:A.find(function(b){return 1==b.size&&b.nodes[0].id===a.target.id}),dummy1:A.find(function(b){return 1==b.size&&b.nodes[0].id===a.dummy1.id}),dummy2:A.find(function(b){return 1==b.size&&b.nodes[0].id===a.dummy2.id}),size:a.value,pathid:b})});for(h=0;h<b.links.length;++h)if(p=
    b.links[h],p.source.group&&(g=w(p.source),p.target.group)){var x=w(p.target);g!=x&&(y[g].link_count+=p.value,y[x].link_count+=p.value);g=t[g]?v[p.source.id]:v[g];x=t[x]?v[p.target.id]:v[x];var n=g<x?g+"|"+x:x+"|"+g;g=l[n]||(l[n]={source:g,target:x,size:0});if(p.img||p.self)g.img=!0;p.self&&(g.self=!0);g.size+=p.value}for(a in l)maxLink<l[a].size&&(maxLink=l[a].size),O.push(l[a]);return{nodes:A,links:O,extra:K}};